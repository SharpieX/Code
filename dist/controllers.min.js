angular.module("stack").controller("answerCtrl",["$scope","$rootScope","question","userService","questionsService","answersService","commentsService",function(a,b,c,d,e,f,g){var h=this;d.isLogged()&&e.updateViews(c),d.getUserModel().then(function(a){h.user=a}),h.question=c,h.question.showCommentArea=!1,h.toLogin=function(){angular.element("#myModal").modal("show")},h.checkVoteDown=function(a){a||(a=[]);var b=[];return h.user?(a.length&&(b=a.filter(function(a){return a===h.user._id})),b.length>0):!1},h.canCheckAnswer=function(){return h.user&&"admin"===h.user.role?!0:!1},h.toggleCommentArea=function(a,b,c){if(d.isLogged())if("answer"===c){var e=h.question.answers[b].showCommentArea||!1;h.question.answers[b].showCommentArea=!e;for(var f=0,g=h.question.answers.length;g>f;f++)f!==b&&(h.question.answers[f].showCommentArea=!1)}else h.question.showCommentArea=!h.question.showCommentArea},h.setChecked=function(a,b){b.checked=!b.checked,f.updateModel(b,"checked").then(function(){console.log("Verifed answer")})["catch"](function(){console.error("Error during check answer"),b.checked=!1})},h.commentQuestion=function(a,b){d.isLogged()&&g.createComment(a,b,h.user).then(function(b){e.commentQuestion(a,b).then(function(){h.questionCommentText=""})})["catch"](function(a){console.log("Not authorized")})},h.commentAnswer=function(a,b){g.createComment(a,b,h.user).then(function(b){f.comment(a,b).then(function(){h.commentAnswerText=""})["catch"](function(a){console.log("Not authorized")})})},h.voteUp=function(a,b){if(d.isLogged())if(b)f.voteUp(b).then(function(a){b.totalVote=a})["catch"](function(){console.log("Not authorized")});else{var c=d.getUserModel();e.voteUp(a,c).then(function(a){h.qTotalVote=a||0})["catch"](function(){console.log("Not authorized")})}},h.voteDown=function(a,b){d.isLogged()&&(b?f.voteDown(b).then(function(a){b.totalVote=a})["catch"](function(a){console.log("Not authorized")}):e.voteDown(a).then(function(a){h.qTotalVote=a||0})["catch"](function(a){console.log("Not authorized")}))}}]),angular.module("stack").controller("answerEditCtrl",["$scope","userService","answersService","questionsService","$http",function(a,b,c,d,e){var f=this;b.isLogged()&&(f.newAnswer={checked:!1,text:""}),b.getUserModel().then(function(a){f.user=a}),f.successInCreation=!1,f.errorInCreation=!1,f.createAnswer=function(a){c.createAnswer(f.newAnswer,f.user).then(function(b){b.author=f.user,b.dt_create=moment(b.dt_create).format("ll"),d.submitAnswer(a,b).then(function(){f.successInCreation=!0,f.newAnswer.text=""})["catch"](function(a){console.log(a),f.errorInCreation=!0,setTimeout(function(){f.successInCreation=!1},2e3)})})["catch"](function(a){console.log(a),f.errorInCreation=!0})}}]),angular.module("stack").controller("askCtrl",["$rootScope","$http","$location","userService","tagsService","questionsService","Upload","$mdToast",function(a,b,c,d,e,f,g,h){function i(){var a=j.toastPosition;a.bottom&&k.top&&(a.top=!1),a.top&&k.bottom&&(a.bottom=!1),a.right&&k.left&&(a.left=!1),a.left&&k.right&&(a.right=!1),k=angular.extend({},a)}var j=this;j.chapaters,j.cobj={},j.cobj.tags=[],j.selectedTag={},j.cobj.answers=[],j.cobj.views=0,j.questionSubmitted=!1,d.getUserModel().then(function(a){j.cobj.author=a._id}),e.getTags().then(function(a){var b=_.sortBy(a.data.data,"level"),c=_.groupBy(b,function(a){return a.type});j.chapters=_.groupBy(c.chapter,"category"),c.chapter=[],j.tags=c,console.log(j.tags)});var k={bottom:!0,top:!1,left:!1,right:!0};j.toastPosition=angular.extend({},k),j.getToastPosition=function(){return i(),Object.keys(j.toastPosition).filter(function(a){return j.toastPosition[a]}).join(" ")},j.showSimpleToast=function(a){var b=j.getToastPosition();h.show(h.simple().textContent(a).position(b).hideDelay(3e3))},j.tags=[];j.getTags=function(a){j.tags.length=0;var b={where:{name:{$regex:a}}};return e.searchTag(b).then(function(a){return j.tags=a.data.data.map(function(a){return j.cobj.tags.indexOf(a._id)<0?{name:a.name,_id:a._id}:void 0}),_.without(j.tags,void 0)})},j.onSelect=function(a){j.cobj.tags.push(a._id),"category"===a.type&&(j.tags.chapter=j.chapters[a.id]);var b=a.type;j.selectedTag[b]=a},j.createQuestion=function(){return j.busy=!0,j.cobj.tags.length<2?(j.showSimpleToast("Select atleast first two tags"),void(j.busy=!1)):j.cobj.title?void f.saveQuestion(j.cobj).then(function(){j.cobj={},j.cobj.tags=[],j.cobj.answers=[],j.cobj.views=0,j.cobj.author="",j.cobj.owner="",j.cobj.text="",j.current="",j.questionSubmitted=!0,j.busy=!1,c.url("/dashboard")})["catch"](function(a){console.log(a)}):(j.showSimpleToast("Title is required"),void(j.busy=!1))}}]),angular.module("stack").controller("homeCtrl",["questionsService",function(a){var b=this;b.questions=[],b.page=1,b.per_page=10,b.sort="-dt_create",b.loadQuestions=function(c){a.getQuestions(c).then(function(a){b.questions=a.data.data})},b.loadNext=function(a){if(b.total!==b.questions.length){b.busy=!0;var c={sort:b.sort,page:a,per_page:b.per_page,populate_owner:!0,populate:!0};b.loadQuestions(c)}},b.sortQuestion=function(a){switch(b.busy=!0,b.page=1,b.totalLength=0,b.questions.length=0,a){case"newest":b.sort="-dt_create";break;case"votes":b.sort="-actions.votes.total";break;case"active":b.sort="-dt_update";break;default:b.sort="-dt_create"}b.loadQuestions({sort:b.sort,page:b.page,per_page:b.per_page,populate_owner:!0,populate:!0})}}]),angular.module("stack").controller("menuCtrl",["$rootScope","$scope","$http","$location","$auth",function(a,b,c,d,e){b.$on("$routeChangeSuccess",function(){b.url=d.url()}),b.user=a.user,b.isAuthenticated=function(){return e.isAuthenticated()}}]),angular.module("stack").controller("tagsCtrl",["tagsService","$filter",function(a,b){var c=this;b("orderBy");c.orderTags=function(a){switch(a){case"name":c.tags.sort(function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0}),c.order="name";break;case"-count":c.tags.sort(function(a,b){var c=parseInt(a.count),d=parseInt(b.count);return d-c}),c.order="-count";break;case"-dt_create":c.tags.sort(function(a,b){var c=a.dt_create,d=b.dt_create;return new Date(d)-new Date(c)}),c.order="-dt_create"}},c.sort={popular:!0,name:!1,"-dt_create":!1},c.order="-count",c.searchTag="",a.getTags({sort:"-count"}).then(function(a){c.tags=a.data.data,c.allTags=a.data.data}),c.search=function(){var b='".*'+c.searchTag+'.*"',d={where:'{"name": {"$regex" : '+b+"}}"};a.searchTag(d).then(function(a){c.tags=a})}}]),angular.module("stack").controller("usersCtrl",["users","usersService",function(a,b){var c=this;c.sortOnNewUsers=!0,c.searchUser="",c.userList=a.data,c.search=function(){var a='".*'+c.searchUser+'.*"',d={where:'{"displayName": {"$regex" : '+a+', "$options": "i"}}'};b.searchUser(d).then(function(a){c.userList=a})}}]),angular.module("stack").controller("introCtrl",["questionsService","$scope","$auth","$http",function(a,b,c,d){angular.element("#navigation").sticky({topSpacing:0}),b.goTo=function(a){var b=$(a.currentTarget),c=$(b.attr("href"));c.length&&($("html, body").stop().animate({scrollTop:$(b.attr("href")).offset().top},1500,"easeInOutExpo"),event.preventDefault())},b.isAuthenticated=function(){return c.isAuthenticated()},b.contactUs=function(a){var c={from:b.email,text:b.text,subject:b.subject,phone:b.phone};a&&d({method:"POST",url:"/api/sendEmail",data:c}).then(function(a){a.data.error?b.showError=!0:b.showSuccess=!0})},$("a.totop,a#btn-scroll,a.btn-scroll,.carousel-inner .item a.btn").bind("click",function(a){var b=$(this);$("html, body").stop().animate({scrollTop:$(b.attr("href")).offset().top},1500,"easeInOutExpo"),a.preventDefault()})}]),angular.module("stack").controller("LoginCtrl",["$scope","$location","$auth","toastr","$state","userService","$rootScope",function(a,b,c,d,e,f,g){a.login=function(){c.login(a.userObj).then(function(){d.success("You have successfully signed in!"),e.go("intro"),f.getUserModel().then(function(a){g.user=a})})["catch"](function(a){d.error(a.data.message,a.status)})},a.authenticate=function(a){c.authenticate(a).then(function(){d.success("You have successfully signed in with "+a+"!"),e.go("intro"),f.getUserModel().then(function(a){g.user=a})})["catch"](function(a){a.message?d.error(a.message):a.data?d.error(a.data.message,a.status):d.error(a)})}}]),angular.module("stack").controller("LogoutCtrl",["$location","$auth","toastr","$rootScope","$state",function(a,b,c,d,e){b.isAuthenticated()&&b.logout().then(function(){c.info("You have been logged out"),d.user="",a.path("/"),e.go("intro")})}]),angular.module("stack").controller("SignupCtrl",["$scope","$location","$auth","toastr",function(a,b,c,d){a.signup=function(){c.signup(a.userObj).then(function(a){c.setToken(a),b.path("/"),d.info("You have successfully created a new account and have been signed-in")})["catch"](function(a){d.error(a.data.message)})}}]),angular.module("stack").controller("ProfileCtrl",["$scope","$auth","toastr","Account",function(a,b,c,d){a.getProfile=function(){d.getProfile().then(function(b){a.user=b.data})["catch"](function(a){c.error(a.data.message,a.status)})},a.updateProfile=function(){d.updateProfile(a.user).then(function(){c.success("Profile has been updated")})["catch"](function(a){c.error(a.data.message,a.status)})},a.link=function(d){b.link(d).then(function(){c.success("You have successfully linked a "+d+" account"),a.getProfile()})["catch"](function(a){c.error(a.data.message,a.status)})},a.unlink=function(d){b.unlink(d).then(function(){c.info("You have unlinked a "+d+" account"),a.getProfile()})["catch"](function(a){c.error(a.data?a.data.message:"Could not unlink "+d+" account",a.status)})},a.getProfile()}]);