angular.module("stack").controller("answerCtrl",["$scope","question","userService","questionsService","answersService",function(a,b,c,d,e){var f=this;c.isLogged()&&d.updateViews(b),c.getUserModel().then(function(a){f.user=a}),f.question=b,f.question.showCommentArea=!1,f.qTotalVote=b.actions.votes.users_upvote.length-b.actions.votes.users_downvote.length;for(var g=0,h=f.question.answers.length;h>g;g++)f.question.answers[g].showCommentArea=!1;f.toLogin=function(){window.location.href="/auth/v0/github/connect"},f.checkVoteDown=function(a){var b=[];return f.user?(a.length&&(b=a.filter(function(a){return a===f.user._id})),b.length>0):!1},f.canCheckAnswer=function(){if(!f.user)return!1;var a=!0;if(b.author._id===f.user._id)for(var c=0,d=b.answers.length;d>c&&a;c++){var e=b.answers[c];e.checked&&(a=!1)}else a=!1;return a},f.toggleCommentArea=function(a,b){if(c.isLogged())if("answer"===a.cobjectId){var d=f.question.answers[b].showCommentArea||!1;f.question.answers[b].showCommentArea=!d;for(var e=0,g=f.question.answers.length;g>e;e++)e!==b&&(f.question.answers[e].showCommentArea=!1)}else f.question.showCommentArea=!f.question.showCommentArea},f.setChecked=function(a,b){b.checked=!b.checked,e.updateModel(b,["checked"]).then(function(){return d.updateModel(a,["checked"])})["catch"](function(){console.error("Error during check answer"),b.checked=!1,a.checked=!1})},f.commentQuestion=function(a,b){c.isLogged()&&d.commentQuestion(a,b).then(function(){f.questionCommentText=""})["catch"](function(a){console.log("Not authorized")})},f.commentAnswer=function(a,b){e.comment(a,b).then(function(){f.commentAnswerText=""})["catch"](function(a){console.log("Not authorized")})},f.voteUp=function(a,b){c.isLogged()&&(b?e.voteUp(b).then(function(a){b.totalVote=a})["catch"](function(){console.log("Not authorized")}):d.voteUp(a).then(function(a){f.qTotalVote=a||0})["catch"](function(){console.log("Not authorized")}))},f.voteDown=function(a,b){c.isLogged()&&(b?e.voteDown(b).then(function(a){b.totalVote=a})["catch"](function(a){console.log("Not authorized")}):d.voteDown(a).then(function(a){f.qTotalVote=a||0})["catch"](function(a){console.log("Not authorized")}))}}]),angular.module("stack").controller("answerEditCtrl",["$scope","userService","answersService","questionsService","$http",function(a,b,c,d,e){var f=this;b.isLogged()&&(f.newAnswer={checked:!1,text:""},b.getUserModel().then(function(a){f.user=a,f.newAnswer.author=a._id})),f.successInCreation=!1,f.errorInCreation=!1,f.createAnswer=function(b){c.createAnswer(f.newAnswer).then(function(c){c.author=f.user,c.dt_create=moment(c.dt_create).format("ll"),d.submitAnswer(b,c).then(function(){f.successInCreation=!0,a.$apply(function(){f.successInCreation=!1,f.newAnswer.text=""})})["catch"](function(a){console.log(a),f.errorInCreation=!0,setTimeout(function(){f.successInCreation=!1},2e3)})})["catch"](function(a){console.log(a),f.errorInCreation=!0})}}]),angular.module("stack").controller("askCtrl",["$rootScope","$http","$location","userService","tagsService","questionsService",function(a,b,c,d,e,f){var g=this;g.cobj={},g.cobj.tags=[],g.selected=[],g.cobj.answers=[],g.cobj.views=0,g.questionSubmitted=!1,d.getUserModel().then(function(a){g.cobj.author=a._id}),g.tags=[];g.getTags=function(a){g.tags.length=0;var b='".*'+a+'.*"',c={where:'{"name": {"$regex" : '+b+"}}"};return e.searchTag(c).then(function(a){return g.tags=a.map(function(a){return g.cobj.tags.indexOf(a._id)<0?{name:a.name,_id:a._id}:void 0}),_.without(g.tags,void 0)})},g.onSelect=function(a,b,c){g.selected.push(a),g.cobj.tags.push(a._id),g.current=""},g.removeTag=function(a){g.cobj.tags.splice(a,1),g.selected.splice(a,1)},g.createQuestion=function(){g.busy=!0,f.saveQuestion(g.cobj).then(function(){g.cobj={},g.cobj.tags=[],g.cobj.answers=[],g.cobj.views=0,g.cobj.author=a.user.id,g.cobj.owner=a.user.id,g.cobj.text="",g.current="",g.questionSubmitted=!0,g.busy=!1,c.url("/index")})["catch"](function(a){console.log(a)})}}]),angular.module("stack").controller("homeCtrl",["questionsService",function(a){var b=this;b.questions=[],b.page=1,b.per_page=10,b.sort="-dt_create",b.loadQuestions=function(c){a.getQuestions(c).then(function(a){b.questions=a.questions,b.total=a.pagination,b.page++,b.busy=!1})},b.loadNext=function(a){if(b.total!==b.questions.length){b.busy=!0;var c={sort:b.sort,page:a,per_page:b.per_page,populate_owner:!0,populate:!0};b.loadQuestions(c)}},b.sortQuestion=function(a){switch(b.busy=!0,b.page=1,b.totalLength=0,b.questions.length=0,a){case"newest":b.sort="-dt_create";break;case"votes":b.sort="-actions.votes.total";break;case"active":b.sort="-dt_update";break;default:b.sort="-dt_create"}b.loadQuestions({sort:b.sort,page:b.page,per_page:b.per_page,populate_owner:!0,populate:!0})}}]),angular.module("stack").controller("menuCtrl",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.$on("$routeChangeSuccess",function(){b.url=d.url()}),b.user=a.user,a.$watch("user",function(a,c){b.user=a},!0)}]),angular.module("stack").controller("tagsCtrl",["tagsService","$filter",function(a,b){var c=this;b("orderBy");c.orderTags=function(a){switch(a){case"name":c.tags.sort(function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0}),c.order="name";break;case"-count":c.tags.sort(function(a,b){var c=parseInt(a.count),d=parseInt(b.count);return d-c}),c.order="-count";break;case"-dt_create":c.tags.sort(function(a,b){var c=a.dt_create,d=b.dt_create;return new Date(d)-new Date(c)}),c.order="-dt_create"}},c.sort={popular:!0,name:!1,"-dt_create":!1},c.order="-count",c.searchTag="",a.getTags({sort:"-count"}).then(function(a){c.tags=a,c.allTags=a}),c.search=function(){var b='".*'+c.searchTag+'.*"',d={where:'{"name": {"$regex" : '+b+"}}"};a.searchTag(d).then(function(a){c.tags=a})}}]),angular.module("stack").controller("usersCtrl",["users","usersService",function(a,b){var c=this;c.sortOnNewUsers=!0,c.searchUser="",c.userList=a,c.search=function(){var a='".*'+c.searchUser+'.*"',d={where:'{"displayName": {"$regex" : '+a+', "$options": "i"}}'};b.searchUser(d).then(function(a){c.userList=a})}}]);