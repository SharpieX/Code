angular.module("stack").controller("answerCtrl",["$scope","$rootScope","question","userService","questionsService","answersService","commentsService","CONSTANTS",function(a,b,c,d,e,f,g,h){var i=this;d.isLogged()&&e.updateViews(c),d.getUserModel().then(function(a){i.user=a});var j=_(c.answers).chain().sortBy(function(a){return a.author.role}).sortBy(function(a){return!a.checked}).value();i.question=c,i.question.answers=j,i.question.showCommentArea=!1,i.toLogin=function(){},i.checkVoteDown=function(a){a||(a=[]);var b=[];return i.user?(a.length&&(b=a.filter(function(a){return a===i.user._id})),b.length>0):!1},i.canCheckAnswer=function(){return i.user&&i.user.role===h.USER_PERMS.ADMIN.key?!0:!1},i.toggleCommentArea=function(a,b,c){if(d.isLogged())if("answer"===c){var e=i.question.answers[b].showCommentArea||!1;i.question.answers[b].showCommentArea=!e;for(var f=0,g=i.question.answers.length;g>f;f++)f!==b&&(i.question.answers[f].showCommentArea=!1)}else i.question.showCommentArea=!i.question.showCommentArea},i.setChecked=function(a,b){b.checked=!b.checked,f.updateModel(b,"checked").then(function(){console.log("Verifed answer")})["catch"](function(){console.error("Error during check answer"),b.checked=!1})},i.commentQuestion=function(a,b){d.isLogged()&&g.createComment(a,b,i.user).then(function(b){e.commentQuestion(a,b).then(function(){i.questionCommentText=""})})["catch"](function(a){console.log("Not authorized")})},i.commentAnswer=function(a,b){g.createComment(a,b,i.user).then(function(b){f.comment(a,b).then(function(){i.commentAnswerText=""})["catch"](function(a){console.log("Not authorized")})})},i.voteUp=function(a,b){if(d.isLogged())if(b)f.voteUp(b).then(function(a){b.totalVote=a})["catch"](function(){console.log("Not authorized")});else{var c=d.getUserModel();e.voteUp(a,c).then(function(a){i.qTotalVote=a||0})["catch"](function(){console.log("Not authorized")})}},i.voteDown=function(a,b){d.isLogged()&&(b?f.voteDown(b).then(function(a){b.totalVote=a})["catch"](function(a){console.log("Not authorized")}):e.voteDown(a).then(function(a){i.qTotalVote=a||0})["catch"](function(a){console.log("Not authorized")}))}}]),angular.module("stack").controller("answerEditCtrl",["$scope","userService","answersService","questionsService","$http","notificationService",function(a,b,c,d,e,f){var g=this;b.isLogged()&&(g.newAnswer={checked:!1,text:""}),b.getUserModel().then(function(a){g.user=a}),g.successInCreation=!1,g.errorInCreation=!1,g.createAnswer=function(a){c.createAnswer(g.newAnswer,g.user).then(function(b){b.author=g.user,b.dt_create=moment(b.dt_create).format("ll"),d.submitAnswer(a,b).then(function(){g.successInCreation=!0,g.newAnswer.text="",f.notify(a.author.email,"Question Answered").then(function(){console.log("Question Answered")})})["catch"](function(a){console.log(a),g.errorInCreation=!0,setTimeout(function(){g.successInCreation=!1},2e3)})})["catch"](function(a){console.log(a),g.errorInCreation=!0})}}]),angular.module("stack").controller("askCtrl",["$rootScope","$http","$location","userService","tagsService","questionsService","Upload","$mdToast",function(a,b,c,d,e,f,g,h){function i(a){e.searchTag(a).then(function(a){var b=a.data.data,c=_.groupBy(b,function(a){return a.type});for(var d in c)if(c.hasOwnProperty(d)){var e=_.find(k.categories,function(a){return a.name===d});e.options=c[d]}})}function j(){var a=k.toastPosition;a.bottom&&l.top&&(a.top=!1),a.top&&l.bottom&&(a.bottom=!1),a.right&&l.left&&(a.left=!1),a.left&&l.right&&(a.right=!1),l=angular.extend({},a)}var k=this;k.cobj={},k.cobj.tags=[],k.selectedTag={},k.cobj.answers=[],k.cobj.views=0,k.questionSubmitted=!1,k.categories=[{name:"class",options:[]},{name:"subject",options:[]},{name:"topic",options:[]}],d.getUserModel().then(function(a){k.cobj.author=a._id}),i({type:"class"});var l={bottom:!0,top:!1,left:!1,right:!0};k.toastPosition=angular.extend({},l),k.getToastPosition=function(){return j(),Object.keys(k.toastPosition).filter(function(a){return k.toastPosition[a]}).join(" ")},k.showSimpleToast=function(a){var b=k.getToastPosition();h.show(h.simple().textContent(a).position(b).hideDelay(3e3))},k.tags=[];k.onSelect=function(a){if(0===k.cobj.tags.length)k.cobj.tags.push(a);else{var b=_.findIndex(k.cobj.tags,function(b){return b.type===a.type});b>=0?k.cobj.tags[b]=a:k.cobj.tags.push(a)}if("class"===a.type){var c=_.filter(k.categories,function(b){return b.name.toLowerCase()!==a.type});_.each(c,function(a){delete k.selectedTag[a.name],a.options=[]});var d=6<=a.id&&a.id<=10?"6":"10",e={$and:[{type:"subject"},{$or:[{category:d},{category:0}]}]};i(e),k.showSimpleToast("Next Choose Subject ")}if("subject"===a.type){var f=_.find(k.cobj.tags,function(a){return"class"===a.type});f?(k.showSimpleToast("Next Choose Topic "),i({type:"topic",category:parseInt(f.id),subject:a.id})):k.showSimpleToast("Select Class first ")}var g=a.type;k.selectedTag[g]=a},k.createQuestion=function(){return k.busy=!0,k.cobj.tags=_.pluck(k.cobj.tags,"_id"),k.cobj.tags.length<2?(k.showSimpleToast("Select atleast first two tags"),void(k.busy=!1)):k.cobj.title?void f.saveQuestion(k.cobj).then(function(){k.cobj={},k.cobj.tags=[],k.cobj.answers=[],k.cobj.views=0,k.cobj.author="",k.cobj.owner="",k.cobj.text="",k.current="",k.questionSubmitted=!0,k.busy=!1,c.url("/dashboard")})["catch"](function(a){console.log(a)}):(k.showSimpleToast("Title is required"),void(k.busy=!1))}}]),angular.module("stack").controller("homeCtrl",["questionsService",function(a){var b=this;b.questions=[],b.page=1,b.per_page=10,b.sort="-dt_create",b.style="stamp",b.expertAnswered=function(a){var b=_.filter(a.answers,function(a){return a.checked});return b&&b.length>0},b.loadQuestions=function(c){a.getQuestions(c).then(function(a){b.questions=a.data.data})},b.loadNext=function(a){if(b.total!==b.questions.length){b.busy=!0;var c={sort:b.sort,page:a,per_page:b.per_page,populate_owner:!0,populate:!0};b.loadQuestions(c)}}}]),angular.module("stack").controller("menuCtrl",["$rootScope","$scope","$http","$location","$auth",function(a,b,c,d,e){b.$on("$routeChangeSuccess",function(){b.url=d.url()}),b.user=a.user,b.isAuthenticated=function(){return e.isAuthenticated()}}]),angular.module("stack").controller("tagsCtrl",["tagsService","$filter",function(a,b){var c=this;b("orderBy");c.orderTags=function(a){switch(a){case"name":c.tags.sort(function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0}),c.order="name";break;case"-count":c.tags.sort(function(a,b){var c=parseInt(a.count),d=parseInt(b.count);return d-c}),c.order="-count";break;case"-dt_create":c.tags.sort(function(a,b){var c=a.dt_create,d=b.dt_create;return new Date(d)-new Date(c)}),c.order="-dt_create"}},c.sort={popular:!0,name:!1,"-dt_create":!1},c.order="-count",c.searchTag="",a.getTags({sort:"-count"}).then(function(a){c.tags=a.data.data,c.allTags=a.data.data}),c.search=function(){var b='".*'+c.searchTag+'.*"',d={where:'{"name": {"$regex" : '+b+"}}"};a.searchTag(d).then(function(a){c.tags=a})}}]),angular.module("stack").controller("usersCtrl",["users","usersService",function(a,b){var c=this;c.sortOnNewUsers=!0,c.searchUser="",c.userList=a.data,c.search=function(){var a='".*'+c.searchUser+'.*"',d={where:'{"displayName": {"$regex" : '+a+', "$options": "i"}}'};b.searchUser(d).then(function(a){c.userList=a})}}]),angular.module("stack").controller("introCtrl",["questionsService","$scope","$auth","$http","$mdDialog",function(a,b,c,d,e){angular.element("#navigation").sticky({topSpacing:0}),b.hideNotification=!0,b.goTo=function(a){var b=$(a.currentTarget),c=$(b.attr("href"));c.length&&($("html, body").stop().animate({scrollTop:$(b.attr("href")).offset().top},1500,"easeInOutExpo"),event.preventDefault())},b.isAuthenticated=function(){return c.isAuthenticated()},b.contactUs=function(a){var c={from:b.email,text:b.text,subject:b.subject,phone:b.phone,name:b.name};a&&d({method:"POST",url:"/api/sendEmail",data:c}).then(function(a){a.data.error?b.showError=!0:b.showSuccess=!0})},$("a.totop,a#btn-scroll,a.btn-scroll,.carousel-inner .item a.btn").bind("click",function(a){var b=$(this);$("html, body").stop().animate({scrollTop:$(b.attr("href")).offset().top},1500,"easeInOutExpo"),a.preventDefault()}),b.showPrerenderedDialog=function(a){e.show({contentElement:"#myDialog",parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){console.log("Singh")},function(){b.hideNotification=!1})},b.showPrerenderedDialog()}]),angular.module("stack").controller("LoginCtrl",["$scope","$location","$auth","toastr","$state","userService","$rootScope",function(a,b,c,d,e,f,g){a.login=function(){c.login(a.userObj).then(function(){d.success("You have successfully signed in!"),e.go("home"),f.getUserModel().then(function(a){g.user=a})})["catch"](function(a){d.error(a.data.message,a.status)})},a.authenticate=function(a){c.authenticate(a).then(function(){d.success("You have successfully signed in with "+a+"!"),e.go("intro"),f.getUserModel().then(function(a){g.user=a})})["catch"](function(a){a.message?d.error(a.message):a.data?d.error(a.data.message,a.status):d.error(a)})}}]),angular.module("stack").controller("LogoutCtrl",["$location","$auth","toastr","$rootScope","$state",function(a,b,c,d,e){b.isAuthenticated()&&b.logout().then(function(){c.info("You have been logged out"),d.user="",a.path("/"),e.go("intro")})}]),angular.module("stack").controller("SignupCtrl",["$scope","$location","$auth","toastr",function(a,b,c,d){a.signup=function(){c.signup(a.userObj).then(function(a){c.setToken(a),b.path("/"),d.info("You have successfully created a new account and have been signed-in")})["catch"](function(a){d.error(a.data.message)})}}]),angular.module("stack").controller("ProfileCtrl",["$scope","$auth","toastr","Account",function(a,b,c,d){a.getProfile=function(){d.getProfile().then(function(b){a.user=b.data})["catch"](function(a){c.error(a.data.message,a.status)})},a.updateProfile=function(){d.updateProfile(a.user).then(function(){c.success("Profile has been updated")})["catch"](function(a){c.error(a.data.message,a.status)})},a.changePassword=function(){d.changePassword(a.user).then(function(b){a.messages={success:[b.data]}})["catch"](function(b){a.messages={error:Array.isArray(b.data)?b.data:[b.data]}})},a.link=function(d){b.link(d).then(function(){c.success("You have successfully linked a "+d+" account"),a.getProfile()})["catch"](function(a){c.error(a.data.message,a.status)})},a.unlink=function(d){b.unlink(d).then(function(){c.info("You have unlinked a "+d+" account"),a.getProfile()})["catch"](function(a){c.error(a.data?a.data.message:"Could not unlink "+d+" account",a.status)})},a.getProfile()}]),angular.module("stack").controller("ResetCtrl",["$scope","Account",function(a,b){a.resetPassword=function(){b.resetPassword(a.user).then(function(b){a.messages={success:[b.data]}})["catch"](function(b){a.messages={error:Array.isArray(b.data)?b.data:[b.data]}})}}]),angular.module("stack").controller("ForgotCtrl",["$scope","Account",function(a,b){a.forgotPassword=function(){b.forgotPassword(a.currentUser).then(function(b){a.messages={success:[b.data]}})["catch"](function(b){a.messages={error:Array.isArray(b.data)?b.data:[b.data]}})}}]),angular.module("stack").controller("registrationCtrl",function(a){}),angular.module("stack").controller("adminCtrl",["$scope","Upload","$timeout","tagsService",function(a,b,c,d){function e(b){d.searchTag(b).then(function(b){var c=b.data.data,d=_.groupBy(c,function(a){return a.type});for(var e in d)if(d.hasOwnProperty(e)){var f=_.find(a.categories,function(a){return a.name===e});f.options=d[e]}})}a.categories=[{name:"class",options:[]},{name:"subject",options:[]},{name:"topic",options:[]}],a.selectedTag={},a.tags=[],e({type:"class"}),a.uploadFile=function(d){d.upload=b.upload({url:"api/homework",data:{tags:a.tags,file:d}}),d.upload.then(function(a){c(function(){d.result=a.data})},function(b){b.status>0&&(a.errorMsg=b.status+": "+b.data)},function(a){d.progress=Math.min(100,parseInt(100*a.loaded/a.total))})},a.onSelect=function(b){if(0===a.tags.length)a.tags.push(b);else{var c=_.findIndex(a.tags,function(a){return a.type===b.type});c>=0?a.tags[c]=b:a.tags.push(b)}if("class"===b.type){var d=_.filter(a.categories,function(a){return a.name.toLowerCase()!==b.type});_.each(d,function(b){delete a.selectedTag[b.name],b.options=[]});var f=6<=b.id&&b.id<=10?"6":"10",g={$and:[{type:"subject"},{$or:[{category:f},{category:0}]}]};e(g)}if("subject"===b.type){var h=_.find(a.tags,function(a){return"class"===a.type});h&&e({type:"topic",category:parseInt(h.id),subject:b.id})}var i=b.type;a.selectedTag[i]=b}}]),angular.module("stack").controller("assignmentCtrl",["$scope","Upload","$timeout","$http",function(a,b,c,d){d({method:"GET",url:"/api/assignments"}).then(function(b){a.assignments=b.data.data,console.log(a.assignments),_.each(a.assignments,function(a){a.link=window.location.origin+"/api/resources/uuid?uuid="+a.uuid})})}]);